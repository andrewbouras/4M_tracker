import{b as Ve}from"./chunk-EAWLRCIR.js";import{a as qe}from"./chunk-CSY6ZILA.js";import{b as $e}from"./chunk-ZZPNXVUV.js";import{a as Be}from"./chunk-GXGQ5VTF.js";import{e as ze}from"./chunk-W2BECDAL.js";import{Fd as De,Rb as Y,Sb as P,Wc as Qe,rc as Ie}from"./chunk-4CMCOVQN.js";import{b as Me}from"./chunk-AIQ7AHJY.js";import{h as Pe}from"./chunk-T3HNWLEC.js";import{c as R,j as Le}from"./chunk-T3JEJCOG.js";import{gb as Z,gd as ke,ie as we,jd as xe,ob as Se}from"./chunk-XKUMOCJO.js";import{a as Ue}from"./chunk-2BA2A4Q2.js";import{$ as Ne,E as Ee,a as z,c as ee,l as a,m as g,r as E}from"./chunk-G7PMLIMH.js";import{a as K,m as Ae}from"./chunk-FI5JCZQR.js";import{A as J,Pa as Te,va as Fe}from"./chunk-RISGBUNP.js";import{U as Ce}from"./chunk-HTY4DAML.js";import{a as ve}from"./chunk-6MAAUKN7.js";import{f as be,h as D,n as L}from"./chunk-3KENBVE7.js";D();L();var e=be(ve());D();L();var s=be(ve()),Oe=({width:f,trackColor:v="#181818",spinnerColor:n="#AB9FF2"})=>s.default.createElement("svg",{width:f,height:f,viewBox:"0 0 26 26"},s.default.createElement("g",null,s.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13 23.413c5.751 0 10.413-4.662 10.413-10.413S18.751 2.587 13 2.587 2.587 7.249 2.587 13 7.249 23.413 13 23.413zm0 2.315c7.03 0 12.727-5.699 12.727-12.728S20.03.273 13 .273C5.97.273.273 5.97.273 13 .273 20.03 5.97 25.728 13 25.728z",fill:v})),s.default.createElement("g",null,s.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.382 24.125a1.157 1.157 0 01.623-1.513 10.412 10.412 0 005.607-13.617 1.157 1.157 0 112.136-.89 12.726 12.726 0 01-6.853 16.643 1.157 1.157 0 01-1.513-.623z",fill:n})));Oe.defaultProps={width:44};var te=({diameter:f,color:v,trackColor:n,position:k})=>s.default.createElement(s.default.Fragment,null,s.default.createElement("style",null,`@keyframes rotate {
            100% {
              transform: rotate(360deg);
            }
          }`),s.default.createElement("div",{style:{position:k,width:`${f}px`,height:`${f}px`,animation:"rotate 0.5s linear infinite"}},s.default.createElement(Oe,{width:f,spinnerColor:v,trackColor:n})));te.defaultProps={diameter:44};var Bt=({onClose:f,onClickBuy:v})=>{let{t:n}=Ae(),[k,x]=(0,e.useState)(void 0),oe=Ue(),d=Le(),{quickSelectDenominations:je,minPurchaseAmountUsd:N,maxPurchaseAmountUsd:B,purchaseType:U,fungible:_e,ownerPublicKey:$,purchaseAmount:c,setState:l,paymentMethod:q,provider:V,checkoutQuoteType:He,redirectURL:ne}=d,p=parseFloat(c),m=U==="currency",{name:O,symbol:r,decimals:re,caip19:C,logoURI:We}=_e||{},h=C?.chainId,j=xe(),{data:Xe=""}=we({select:t=>t?.name}),{data:ie}=Ie({query:{data:C}}),i=ie?ie?.usd:void 0,{currencySymbol:Ge,currencyCode:T,toUsd:w,fromUsd:A}=Me(),I=(0,e.useMemo)(()=>{if(k)return!1;let t=c.length>0,o=p>0,y=Number.isFinite(p);return t&&o&&y},[k,c,p]),Je=(0,e.useMemo)(()=>{if(!i)return`??? ${r}`;if(m){let o=Qe.get(h).formDisplayPrecision,y=w(p),Q=P(y,i,o),F=De(Q,o);return c===""?`0 ${r}`:F.length+(r?.length??0)<15?`~${F} ${r}`:`~${F.substring(0,8)}... ${r}`}let t=c===""?0:Y(p,i);return e.default.createElement(qe,{value:t,font:"caption",color:"textSecondary"})},[r,h,c,p,m,w,i]),[Ke,_]=(0,e.useState)(500),Ze=Ce({purchaseAmount:c,purchaseType:U},Ke),{purchaseAmount:S,purchaseType:ae}=Ze,M=(0,e.useCallback)(t=>{let o=parseFloat(t),y=m?T?.toUpperCase():r,Q=m?Number(A(N)):P(N,i??0,R),F=m?Number(A(B)):P(B,i??0,R),rt=o<Q,it=o>F,he=rt?n("buyAssetScreenMinPurchasePriceInterpolated",{amount:`${Q} ${y}`}):it?n("buyAssetScreenMaxPurchasePriceInterpolated",{amount:`${F} ${y}`}):void 0;return he==null?{status:"pass"}:{status:"fail",message:he}},[A,m,n,T,r,N,i,B]),Ye=(0,e.useCallback)(({value:t})=>M(t),[M]),se=(0,e.useCallback)(t=>{let o=M(t);_(500),l({...d,purchaseAmount:t,checkoutQuoteType:"recommended"}),x(o?o.message:void 0)},[d,l,M]),Re=(0,e.useCallback)(t=>{j.capture("fiatOnrampAmountSelected",{data:{networkId:h,chainId:Z.getChainID(h),asset:{name:O,symbol:r,type:"fungible"},amount:t}}),_(100),l({...d,purchaseAmount:t,purchaseType:"currency",checkoutQuoteType:"recommended"}),x(void 0)},[d,r,O,h,l,j]),et=(0,e.useCallback)(t=>{if(t.preventDefault(),!i)return;let o=m?P(w(p),i,re):A(Y(p,i));_(100),l({...d,purchaseAmount:o.toString(),purchaseType:m?"token":"currency"}),x(void 0)},[d,re,A,p,l,m,w,i]),{data:[de,me]}=Te(["enable-fiat-ramp-optimize-defaults","enable-fiat-ramp-optimize-default-payment-method"]),H=(0,e.useMemo)(()=>({...ae==="currency"?{fiatAmount:S}:{tokenAmount:S},token:C,fiatCurrencyCode:T,destinationAddress:{address:$,chainId:C?.chainId,resourceType:"address"},optimizeDefaults:de,optimizeDefaultPaymentMethod:me}),[C,S,ae,T,$,de,me]),W=He==="selected",X=!W&&I&&!!S,{data:G,isLoading:ue,isError:ce}=ze("web-embedded",J,K.language,{...H,paymentMethodId:q?.id,providerId:V?.id},X),u=W?q:G?.paymentMethod,b=W?V:G?.provider,le=(0,e.useCallback)(()=>{l({...d,paymentMethod:u}),oe.toStack("fiat-ramp-detail")},[oe,d,u,l]),pe=(0,e.useMemo)(()=>X&&ue?{id:"recommended-quote-loading",topLeft:n("buyThirdPartyScreenLoadingQuote"),end:e.default.createElement(te,{diameter:20}),disabled:!0}:!I||!u||!b||ce?{type:"drawer",id:"no-quote",topLeft:()=>e.default.createElement(e.default.Fragment,null,e.default.createElement(ee.CreditCard,{size:18}),e.default.createElement(g,{font:"caption"},n("buyThirdPartyScreenChoseQuote"))),disabled:!0,onClick:()=>null}:{type:"drawer",id:"selected-quote",onClick:le,topLeft:{text:u?.name,before:u?.assets?.icon?e.default.createElement("img",{src:u?.assets?.icon,width:24,height:24}):void 0},topRight:{text:b?.name}},[le,I,X,ce,ue,u,b,n]),[tt,fe]=(0,e.useState)(!1),ye=I&&(!!G||!!q&&!!V),ot=(0,e.useMemo)(()=>({...H,paymentMethodId:u?.id||"",providerId:b?.id||"",redirectURL:ne}),[H,u?.id,b?.id,ne]),nt=ke(),ge=async t=>{if(ye){t&&t.preventDefault(),j.capture("fiatOnrampBuyClickedByUser",{data:{networkId:h,chainId:Z.getChainID(h),asset:{name:O,symbol:r,type:"fungible"},purchaseType:U,amount:S,paymentMethod:u?.id,provider:b?.id}}),l({...d,price:i??0}),fe(!0);try{let{url:o,sessionId:y}=await Be("web-embedded",J,K.language,ot,nt);v?v(o,y,Se(C),b):self.open(o,"_blank")?.focus()}catch(o){Fe.captureError(o,"onRamp")}fe(!1)}};return e.default.createElement(a,{justifyContent:"space-between",height:"100%"},e.default.createElement(a,null,e.default.createElement(a,{alignItems:"center",gap:32},e.default.createElement(g,{font:"heading3"},n("buyAssetInterpolated",{tokenSymbol:r})),e.default.createElement($e,{image:{type:"fungible",src:We,fallback:r??""},size:96})),e.default.createElement(a,{direction:"row",gap:8,alignItems:"center",justifyContent:"flex-start",marginTop:24,padding:16,borderRadius:16,backgroundColor:"bgArea"},e.default.createElement(g,{font:"body"},Xe),e.default.createElement(g,{font:"caption",color:"textSecondary"},"(",Pe($,4),")")),e.default.createElement("form",{onSubmit:void 0,className:z({marginTop:8})},e.default.createElement(Ee,{value:c,onChangeText:se,placeholder:n("amount"),id:"purchaseAmount",label:n("amount"),end:m?T:r,showLabel:!1,validator:Ye,setValue:se}),e.default.createElement(a,{justifyContent:"space-between",direction:"row",alignItems:"center",marginTop:8},e.default.createElement(a,null,e.default.createElement(a,{onPress:et,gap:4},i?e.default.createElement(g,{color:"textSecondary",font:"caption"},Je,i===0?null:e.default.createElement(ee.Swap2Vertical,{size:12,className:z({marginLeft:4})})):e.default.createElement(g,null,`??? ${r}`))),e.default.createElement(a,{direction:"row",gap:8},je.map(t=>e.default.createElement(E,{size:"micro",key:t,theme:c===t?"primary":"secondary",onClick:()=>Re(t)},Ge,e.default.createElement(g,{font:"label"},t))))))),e.default.createElement(a,null,pe&&e.default.createElement(Ne,{rows:[pe]}),e.default.createElement(a,{gap:8,marginTop:12,direction:"row",justifyContent:"space-between",className:Ve},e.default.createElement(E,{theme:"secondary",onClick:f},n("commandCancel")),e.default.createElement(E,{theme:"primary",disabled:!ye||tt,onClick:ge},n("commandBuy")))))};export{Bt as a};
//# sourceMappingURL=chunk-U6VOPZMR.js.map
