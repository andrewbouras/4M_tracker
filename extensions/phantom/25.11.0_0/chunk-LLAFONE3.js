import{$a as Ve,A as Ne,B as Q,Ba as _e,Cb as q,Cc as W,Gc as Xe,Hb as He,Hc as oe,Jb as We,Kb as je,Lb as $e,Sa as De,Ua as Le,Va as Be,Xb as H,Yb as A,Yc as O,_b as Ye,hd as Je,kb as _,mb as Ge,md as D,nb as Ke,pb as Qe,qb as qe,qd as Ze,rd as se,sc as ze,w as Pe,x as ve,y as K,z as ke,za as Oe}from"./chunk-4CMCOVQN.js";import{U as Me,a as te,c as re,j as ne,x as Ue}from"./chunk-6V7ED5GE.js";import{s as Bt}from"./chunk-T3HNWLEC.js";import{Cb as Ce,Fd as M,K as Te,L as T,Le as N,S as B,V as Ee,c as Dt,cb as Ie,gb as I,ie as P,jd as G,lb as Fe,r as Lt,rb as k}from"./chunk-XKUMOCJO.js";import{n as Ae}from"./chunk-EF7ER3CO.js";import{c as be}from"./chunk-DHK5JDA3.js";import{m as R}from"./chunk-FI5JCZQR.js";import{fa as w,ha as x,ka as C,pa as h,va as U}from"./chunk-RISGBUNP.js";import{A as xe,C as he,a as b,b as y,ba as Re,l as we,x as V}from"./chunk-HTY4DAML.js";import{a as E}from"./chunk-6MAAUKN7.js";import{f as S,h as r,m as Buffer,n}from"./chunk-3KENBVE7.js";r();n();r();n();r();n();r();n();var _r="userExplorerPreferenceV2";r();n();r();n();var zr="isAnalyticsOptedOut";r();n();r();n();r();n();r();n();var tt=e=>{let{accountIdentifier:t,autoConfirmEnabled:o=!1,trustedAppsByAccount:s}=e;if(!t||!s)return;let a=Object.values(s),i=[],c=[];o?(a.forEach(p=>{p.autoConfirm&&Ue(p.autoConfirm)?i.push(p):c.push(p)}),i.sort((p,d)=>(d.autoConfirm?.sessionStartTime??0)-(p.autoConfirm?.sessionStartTime??0))):c=a;let m=xe(c.map(p=>{let d=p.lastConnectedTimestamp??0;return{timestamp:d,data:{...p,lastConnectedTimestamp:d}}}));return{autoConfirmEnabledApps:i,timeBucketedApps:m}};r();n();var rt=(e,t)=>{if(!t||e.autoConfirm?.sessionStartTime===void 0||e.autoConfirm?.maxSessionDuration===void 0)return;let o=new Date(e.autoConfirm?.sessionStartTime+e.autoConfirm?.maxSessionDuration*1e3);return he(o).format("h:mm A")};r();n();var Wt=b.object({data:b.string(),from:b.string(),to:b.string()}),jt=b.object({transaction:Wt});async function $t({caip19:e,amount:t,owner:o}){let s=await B.api().post("/tokens/v1/unwrap",{owner:o,caip19:e,amount:t.toNumber()}),a=jt.safeParse(s.data);if(!a.success){let{error:i}=a;throw U.captureError(i,"fungibles"),new H(`Failed to get unwrap transaction: ${i.message}`)}return a.data.transaction}var Yt=({caip19:e,amount:t,owner:o})=>C({gcTime:$e.Medium,staleTime:1/0,enabled:o!==""&&t.isGreaterThan(0),queryKey:A.unwrapTransaction({caip19:e,amount:t,owner:o}),async queryFn(){return await $t({caip19:e,amount:t,owner:o})}});r();n();function zt(){let e=h(),t=G(),o=w();return x({async mutationFn({accountId:s,mutations:a}){await Ye(e,t,{accountId:s,mutations:a})},async onSuccess(s,a){await o.invalidateQueries({queryKey:A.hiddenMints(a.accountId)})}})}r();n();var pe=S(Bt());r();n();var $={recipient:"",recipientHandle:"",addressBookRecipient:void 0,amountAsset:new y(0),amountUsd:0,transactionSpeed:"standard",solana:{references:[]},multichainTransaction:void 0},nt=class extends Error{constructor(t){super(t),this.name="SendFungibleFlowError"}};var ot={sendSessionId:"",fungibleKey:void 0,splTokenAccount:void 0,analyticsRecipient:void 0,sendFormValues:$,shouldShowFiatValues:!1,retryArgs:void 0,confirmedFungibleAndSender:null,gasEstimation:void 0},me=N((e,t)=>({...(0,pe.default)(ot),resetSendSlice:()=>{let o=(0,pe.default)(ot);o.sendSessionId=be(),e(o)},setAnalyticsRecipient:o=>{e({analyticsRecipient:o})},setSendFungibleKey:(o,s)=>{e({fungibleKey:o,splTokenAccount:s})},setSendFormValues:o=>{e({sendFormValues:o})},setInputAmount:o=>{let s=t();e({sendFormValues:{...s.sendFormValues,inputAmount:o}})},setShouldShowFiatValues:o=>{e({shouldShowFiatValues:o})},setRetryArgs:o=>{e({retryArgs:o})},setGasEstimation:o=>{e({gasEstimation:o})}}));r();n();var st={collectible:void 0,sendFormValues:$,shouldRequireAmount:!1},Xt=N(e=>({...st,resetSendSlice:()=>{e({...st})},setSendCollectible:t=>{e({collectible:t})},setSendFormValues:t=>{e({sendFormValues:t})},setShouldRequireAmount:t=>{e({shouldRequireAmount:t})}}));r();n();r();n();var Jt={query:""},Zt=N(e=>({...Jt,setQuery:t=>{e({query:t})}}));r();n();r();n();r();n();var Y=S(Dt(),1),it=S(Lt(),1);var at=(0,Y.struct)([(0,Y.u8)("instruction")]);function ct(e,t,o,s=[],a=_){let i=qe([{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0}],o,s),c=Buffer.alloc(at.span);return at.encode({instruction:Qe.CloseAccount},c),new it.TransactionInstruction({keys:i,programId:a,data:c})}var mt=S(E());r();n();function ut(e,t,o){return T.PublicKey.findProgramAddressSync([e.toBuffer(),o.toBuffer(),t.toBuffer()],Ge)[0]}var er=new H("Unable to unwrap SOL. Wrapped SOL Token account does not exist.");function tr(){let{connection:e}=W(),{data:t}=P(),{solanaChainAddress:o,accountIdentifier:s}=(0,mt.useMemo)(()=>({solanaChainAddress:t?.addresses.find(k),accountIdentifier:t?.identifier??""}),[t]),a=h(),i=M(),{t:c}=R();return x({mutationFn:async()=>{if(!o)return Promise.reject("solanaChainAddress not loaded");let{networkID:m,address:p}=o,d=new T.PublicKey(p),l=ut(d,Ke,_);if(!await e.getAccountInfo(l))throw er;let f=ct(l,d,d,[],_),F=new Te.Transaction().add(f),v={ownerAddress:p,networkID:m,data:{signature:""},type:"unwrapSOL",display:{summary:{topLeft:{text:c("assetDetailUnwrappingSOL")}}}},Se=await q({accountIdentifier:s,accountSigner:i,connection:e,feePayer:new T.PublicKey(p),pendingTransactionInput:v,storage:a,transaction:F,useSubmissionService:!1});return{networkID:m,id:Se}}})}r();n();var dt=S(E());var rr=()=>{let{connection:e}=W(),{data:t}=P(),{solanaChainAddress:o,accountIdentifier:s}=(0,dt.useMemo)(()=>({solanaChainAddress:t?.addresses.find(k),accountIdentifier:t?.identifier??""}),[t]),a=h(),i=M(),{t:c}=R();return x({mutationFn:async m=>{if(!o)throw new Error("solanaChainAddress not loaded");if(m.type!=="CompressedSPL")throw new Error("SPL is not compressed");let p=await He({owner:m.data.walletAddress,mint:m.data.mintAddress,amount:m.data.amount,programId:m.data.programId,connection:e}),{networkID:d,address:l}=o,g={ownerAddress:l,networkID:d,data:{signature:""},type:"decompress",display:{summary:{topLeft:{text:c("assetDetailClaiming")}}}};await q({accountIdentifier:s,accountSigner:i,connection:e,feePayer:new T.PublicKey(l),pendingTransactionInput:g,storage:a,transaction:p,useSubmissionService:!1})}})};r();n();var ge=S(E());r();n();var le=new y(0),fe=({chainAddress:e,type:t,balance:o,decimals:s,recipient:a,gasEstimation:i,clampToZero:c=!0})=>{let{data:m,isPending:p}=oe(e);if(!t||!o)return le;let d=new y(o).multipliedBy(Re(s));if(!O(t))return d;if(!i)return;let l=new y(0);if(K(i))l=d.minus(new y(i.value));else if(Ne(i)){let{gasLimit:g,maxFeePerGas:f,l1Fee:F=new y(0)}=i,v=g.times(f).plus(F);l=d.minus(v)}else if(Q(i)){if(!e||p)return;let g=e.addressType,f=m?.safeToSendUtxos??[],F=ve(i.btcPerKilobyte),v=a&&Ie.safeParse(a).success?a:"bc1p",Nt=[{value:f.reduce((Z,ee)=>Z.plus(new y(ee.value)),new y(0)).toNumber(),address:v}],J=De(g,f,Nt,F.toNumber(),[]);if(J.type==="error")l=new y(J.maxAmount).integerValue(y.ROUND_DOWN);else{let{inputs:Z,fee:ee}=J;l=Z.reduce((Ot,_t)=>Ot.plus(new y(_t.value)),new y(0)).minus(ee).integerValue(y.ROUND_DOWN)}}else if(ke(i))l=d.minus(i.gasBudget);else return we(i);return l.isGreaterThan(le)?l:c?le:l};r();n();var lt=(e,t,o)=>{let s=Ze(e,t),{fungibles:a,isLoadingTokens:i,isErrorTokens:c,isErrorPrices:m}=D({...o,keys:s?[s]:[]});return{isError:m||c,fungible:a.length===1?a[0]:void 0,isLoading:i}};var nr=(e,t,o,s=new y(0),a)=>{let{fungible:i,isLoading:c,isError:m}=lt(e,t),p="unknown",d="",l=(0,ge.useMemo)(()=>{let f=i?.data.walletAddress;if(!f)return;let F=Ce(e,f);return{networkID:e,address:f,addressType:F}},[e,i?.data.walletAddress]),g=fe({chainAddress:l,type:i?.type,balance:i?.data.balance,decimals:i?.data.decimals??0,recipient:a,gasEstimation:o,clampToZero:!1});return!m&&i&&g&&(g.gte(s)?p="sufficient":p="insufficient",d=i.data.symbol||""),(0,ge.useMemo)(()=>({hasSufficientFunds:p,nativeTokenSymbol:d,isLoading:c,isError:m}),[p,d,c,m])};r();n();var At=S(E());r();n();var ye=S(E());r();n();var ft=({chainAddresses:e=[]})=>{let t=A.tokensErrorCount(e);return C({queryKey:t,initialData:0})};r();n();var or=({errors:e})=>e;function gt({chainAddresses:e,queryOptions:t}){return Je({select:or,chainAddresses:e,queryOptions:t})}var yt=3,sr=1,St=({networkID:e,chainAddresses:t=[]})=>{let{data:o=[]}=gt({chainAddresses:t}),{data:s=0}=ft({chainAddresses:t}),a=s>=yt,{data:i=0}=ze(),c=i>=yt,m=o.length===sr&&o.some(l=>l.code==="TokensTrimmed"),{t:p}=R(),d=(0,ye.useMemo)(()=>{if(a)return p("partialErrorGeneric");let l=o.filter(f=>e?f.details.chainId===e:!0),g=l.length+(c?1:0);return g?g>1?p("partialErrorGeneric"):c?p("partialErrorTokenPrices"):m?p("partialErrorTokensTrimmed"):e?p("partialErrorTokenDetail"):p("partialErrorBalanceChainName",{chainName:I.getChainName(l[0].details.chainId)}):""},[a,o,c,e,m,p]);return(0,ye.useMemo)(()=>({partialErrorMessage:d,shouldShowPartialError:d!==""}),[d])};function ar(e){let{onTappingBuy:t,onTappingReceive:o,onTappingSend:s,onTappingSwap:a,account:i}=e,{shouldShowPartialError:c,partialErrorMessage:m}=St({chainAddresses:i?.addresses});return{ctaActions:ir({onTappingBuy:t,onTappingReceive:o,onTappingSend:s,onTappingSwap:a}),shouldShowPartialError:c,partialErrorMessage:m}}function ir(e){let{t}=R();return(0,At.useMemo)(()=>{let s=[];return s.push({text:t("commandSend"),type:"send",onClick:e.onTappingSend}),s.push({text:t("commandSwap"),type:"swap",onClick:e.onTappingSwap}),s.push({text:t("commandReceive"),type:"receive",onClick:e.onTappingReceive}),s.push({text:t("commandBuy"),type:"buy",onClick:e.onTappingBuy}),s.sort((a,i)=>(se.get(a.type)??100)-(se.get(i.type)??100)),{primary:s,more:[]}},[t,e.onTappingSend,e.onTappingSwap,e.onTappingReceive,e.onTappingBuy])}r();n();var Tt=S(E());var cr=({networkID:e,unsignedTransaction:t,pendingActivityRows:o,accountIdentifier:s,accountSigner:a,storage:i,includeCallPayload:c})=>({accountSigner:a,accountIdentifier:s,networkID:e,unsignedTransaction:t,...c&&{callPayload:{from:t.from,to:t.to,data:t.data,value:t.value}},pendingTransactionInput:{ownerAddress:t.from,networkID:e,data:{nonce:"",unsignedTransaction:t,hash:""},type:"swap",display:{summary:o}},storage:i}),ur=async({t:e,fungible:t,unsignedUnwrapTx:o,gasEstimation:s,storage:a,accountMetadata:i,accountSigner:c})=>{if(!o)throw new Error("Unsigned unwrap transaction is required");if(!s)throw new Error("Gas estimation is required");let{chain:m,balance:p}=t.data;if(!I.isEthereumNetworkID(m.id))throw new Error(`Chain is not supported: ${m.id}`);let d=m.id,l={topRight:{text:`+${p} ${m.symbol}`},topLeft:{text:e("transactionsPendingSwapping")},bottomRight:{text:`-${p} ${t.data.symbol}`},bottomLeft:{text:`${t.data.name}`}},g=Ae.parse({type:"0x2",chainId:I.getEVMNetworkIDValue(d),gas:`0x${s.gasLimit.toString(16)}`,maxFeePerGas:`0x${s.maxFeePerGas.toString(16)}`,maxPriorityFeePerGas:`0x${s.maxPriorityFeePerGas.toString(16)}`,...o}),f=cr({storage:a,accountSigner:c,pendingActivityRows:l,includeCallPayload:!1,networkID:d,unsignedTransaction:g,accountIdentifier:i.accountIdentifier});return Ve(f)},pr=()=>{let{data:e}=P();return(0,Tt.useMemo)(()=>{let o=e?.type,s=e?.name??"",a=e?.identifier??"";return{accountName:s,accountType:o,accountIdentifier:a}},[e])},mr=e=>{let t=h(),o=w(),{t:s}=R(),a=pr(),i=M();return x({async mutationFn({fungible:c,unsignedUnwrapTx:m,gasEstimation:p}){return await ur({t:s,fungible:c,unsignedUnwrapTx:m,gasEstimation:p,accountMetadata:a,storage:t,accountSigner:i})},async onSuccess(){await o.invalidateQueries({queryKey:A.tokens(e)})}})};r();n();r();n();r();n();var Et=()=>{let{setRetryArgs:e}=me();return t=>{if(t instanceof Be){let{successfulTxIds:o}=t,[s,a]=o;e({type:"BRC20",commitTxId:s,revealTxId:a})}}};function dr(){let e=h(),{data:t}=P({select:c=>c.identifier}),o=Et(),s=Xe(),a=M();return x({mutationFn:async({multichainTransaction:c,pendingTransactionInput:m,senderAddress:p,gasEstimation:d})=>{if(!t)throw new Error("No account identifier found");let{networkID:l}=c,g=await Oe.get(l).onBeforeSend({multichainTransaction:c,gasEstimation:d}),f=await je({accountIdentifier:t,accountSigner:a,multichainTransaction:g,networkID:l,pendingTransactionInput:m,senderAddress:p,storage:e,utxoManager:s});return We(l,f)},onError(c){c instanceof Error&&(U.captureError(c,"fungibles"),c instanceof Le&&o(c))}})}r();n();var bt=S(E());var lr=(e,t,o)=>{let s=w(),{fungibles:a}=D({keys:[e]}),i=a.length===1?a[0]:void 0;(0,bt.useEffect)(()=>{if(!i)return;let{type:c,data:m}=i,{balance:p,decimals:d,chain:l}=m,{id:g}=l,f=O(c)===!0;if(!o||!p||f||p.isEqualTo(t))return;let F=A.transferFungibleLoggingContext(e),v={transactionId:o,decimals:d,chainId:g,isNativeToken:f,previousBalance:p,fungibleKey:e};s.setQueryData(F,v)},[o])};r();n();var wt=V({minutes:1}),fr=(e,t=!0)=>{let o=A.solanaBalance(e);return C({enabled:!!e&&t&&k(e),gcTime:wt,staleTime:wt,queryKey:o,async queryFn(){if(!e)throw new Error("No chain address provided");if(k(e))return _e(e.networkID).getBalance(new T.PublicKey(e.address));throw new Error(`SOL balance not implemented for ${e.networkID}`)}})};r();n();r();n();var xt=S(E());var gr=e=>{let{data:t}=Me();return(0,xt.useMemo)(()=>{if(!e||!t)return;let o=e.data.chain.id,s=t.explorers[o]??te.get(o).defaultExplorer,a,i;if(O(e.type))i="address",a=e.data.walletAddress;else switch(e.type){case"SuiCoin":{i="token",a=e.data.contractAddress;break}case"ERC20":{i="address",a=e.data.contractAddress;break}case"SPL":case"CompressedSPL":{i="address",a=e.data.mintAddress;break}case"BRC20":return{explorerName:"Unisat",explorerUrl:`https://unisat.io/brc20?q=${e.data.walletAddress}`}}let c=ne({networkID:o,endpoint:i,explorerType:s,param:a});return{explorerName:re[s],explorerUrl:c}},[e,t])};r();n();var ht=S(E());var yr=e=>{let t=w();return(0,ht.useCallback)(()=>t.invalidateQueries({queryKey:A.tokens(e)}),[t,e])};r();n();var Rt=S(E()),Sr=(e,t)=>(0,Rt.useMemo)(()=>{if(e)if(Q(e)){let o=Pe(e).toNumber().toLocaleString("en-US");return{leftSubtext:void 0,leftSubtextColor:void 0,rightSubtext:t("satsAmount",{sats:o.toString()})}}else return K(e)&&e.highFees?{leftSubtext:t("notificationTransactionApprovalNetworkFeeHighWarning"),leftSubtextColor:"#ffdc62",rightSubtext:""}:void 0},[e,t]);r();n();var Ar=S(E());r();n();r();n();var kt=S(E());r();n();var X=(a=>(a.FAIL_SEVERE="FAIL_SEVERE",a.FAIL_HIGH="FAIL_HIGH",a.NO_ACTION="NO_ACTION",a.DATA_NOT_FOUND="DATA_NOT_FOUND",a))(X||{}),Tr=b.object({action:b.nativeEnum(X),address:Fe,expirationUnixtimeInSec:b.number().nullish().default(null)}),It=b.object({addressScreenResults:b.array(Tr)}),z=class extends Error{constructor(t){super(t),this.name="WalletScreenError"}};r();n();r();n();var Er="@phantom/wallet-screening",Ft=`${Er}:wallet-screen-action`,Ct={walletScreenAction(e){return[Ft,e]}};r();n();var Ut=new Error("Failed to fetch wallet screen action.");async function Mt(e){try{let t=await B.api().post("/wallet_screen/v1",e);if(!Ee(t))throw Ut;let o=t.data;return It.parse(o)}catch{throw Ut}}var Pt=V({days:7}),vt=e=>{let t=e!==void 0&&I.isMainnetNetworkID(e.networkID),o=[];if(e!==void 0){let m=I.isEVMNetworkID(e.networkID)?e.address.toLowerCase():e.address;o=[{chainId:e.networkID,address:m,resourceType:"address"}]}let s={addresses:o},a=w(),i=Ct.walletScreenAction(s),c=[i[0]];return C({enabled:t,queryKey:i,gcTime:Pt,staleTime:Pt,refetchInterval:!1,refetchOnMount:!1,async queryFn(){if(br(a,c))return"FAIL_SEVERE";let p=await Mt(s);return wr(p)}})},br=(e,t)=>{let o=e.getQueriesData({queryKey:t,exact:!1}),s=!1;for(let[a,i]of o){let c=i;if(c&&c==="FAIL_SEVERE"){s=!0;break}}return s},wr=e=>{let t=e.addressScreenResults;return t.some(o=>o.action==="FAIL_SEVERE")?"FAIL_SEVERE":t.some(o=>o.action==="FAIL_HIGH")?"FAIL_HIGH":t.some(o=>o.action==="NO_ACTION")?"NO_ACTION":"DATA_NOT_FOUND"};var xr=(e,t)=>{let o=G(),{data:s}=vt(e);switch((0,kt.useEffect)(()=>{s&&e&&o.capture("walletScreened",{data:{walletScreen:{action:s.toString(),surface:t},chainId:I.getChainID(e.networkID),networkId:e.networkID}})},[s,e,t,o]),s){case"FAIL_SEVERE":case"FAIL_HIGH":throw new z(`Transaction disabled: ${t}`);case"NO_ACTION":case"DATA_NOT_FOUND":return}};r();n();r();n();export{tt as a,rt as b,ct as c,Yt as d,zt as e,nt as f,me as g,Xt as h,dr as i,lr as j,fe as k,tr as l,rr as m,fr as n,gr as o,nr as p,St as q,ar as r,yr as s,Sr as t,mr as u,z as v,Ft as w,xr as x};
//# sourceMappingURL=chunk-LLAFONE3.js.map
